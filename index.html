import React, { useState, useMemo } from 'react';
import { 
  Globe, 
  Search, 
  DollarSign, 
  TrendingUp, 
  Users, 
  FileCheck, 
  AlertCircle, 
  LayoutDashboard,
  Clock,
  ExternalLink,
  ShieldCheck,
  Download,
  Menu,
  X
} from 'lucide-react';

// --- Mock Data ---
const mockData = [
  { region: 'ë™ì•„ì‹œì•„', country: 'CNì¤‘êµ­(China)', city: 'ìƒí•´', localTime: '16:37:34', sales25: 24888.93, cert: 'NMPA Filing', buyer: 'KC ì´ë„ˆë²¨ë¼', type: 'ê±°ë˜ì„ ', contact: 'ì–‘ìŠ¹ë£¡(í•œêµ­ì¸)', status: 'Existing' },
  { region: 'ë¶ì•„ë©”ë¦¬ì¹´', country: 'ğŸ‡ºğŸ‡¸ ë¯¸êµ­ (United States)', city: 'LA', localTime: '01:37:34', sales25: 5144.9, cert: 'FDA', buyer: 'RELAXATION with headspa K', type: 'ê°€ë§¹ì /êµìœ¡ì›', contact: 'ê¹€í¬ì • Astrid Kim', status: 'Existing' },
  { region: 'ì˜¤ì„¸ì•„ë‹ˆì•„', country: 'ğŸ‡¦ğŸ‡º ì˜¤ìŠ¤íŠ¸ë ˆì¼ë¦¬ì•„(Australia)', city: 'ì‹œë“œë‹ˆ', localTime: '19:37:34', sales25: 23363, cert: 'Ministry of Health', buyer: 'NKM SOLUTIONS PTY LTD', type: 'ì´íŒ', contact: 'ê¹€ë‚¨ì€ Nicky', status: 'Existing' },
  { region: 'ìœ ëŸ½', country: 'ğŸ‡«ğŸ‡· í”„ë‘ìŠ¤ (France)', city: 'Paris', localTime: '09:37:34', sales25: 0, cert: 'CPNP', buyer: 'Les Divas', type: 'ê±°ë˜ì„ ', contact: 'FRA Yhssene', status: 'Existing' },
  { region: 'ì•„ì‹œì•„', country: 'íƒœêµ­', city: '-', localTime: '15:37:34', sales25: 0, cert: 'FDA e-Notification', buyer: '-', type: 'ì‹ ê·œ', contact: '-', status: 'New' },
];

const App = () => {
  const [searchTerm, setSearchTerm] = useState('');
  const [activeTab, setActiveTab] = useState('all'); 
  const [selectedRegion, setSelectedRegion] = useState('All');
  const [isSidebarOpen, setIsSidebarOpen] = useState(false);

  const regions = ['All', 'ë™ì•„ì‹œì•„', 'ë¶ì•„ë©”ë¦¬ì¹´', 'ìœ ëŸ½', 'ì˜¤ì„¸ì•„ë‹ˆì•„', 'ì•„ì‹œì•„', 'ë‚¨ì•„ë©”ë¦¬ì¹´'];

  const filteredData = useMemo(() => {
    return mockData.filter(item => {
      const matchesSearch = 
        item.country.toLowerCase().includes(searchTerm.toLowerCase()) ||
        item.buyer.toLowerCase().includes(searchTerm.toLowerCase()) ||
        item.contact.toLowerCase().includes(searchTerm.toLowerCase());
      
      const matchesRegion = selectedRegion === 'All' || item.region === selectedRegion;
      
      const matchesTab = 
        activeTab === 'all' || 
        (activeTab === 'existing' && item.status === 'Existing') ||
        (activeTab === 'new' && item.status === 'New');

      return matchesSearch && matchesRegion && matchesTab;
    });
  }, [searchTerm, selectedRegion, activeTab]);

  const totalSales25 = useMemo(() => 
    filteredData.reduce((acc, curr) => acc + curr.sales25, 0), 
  [filteredData]);

  return (
    <div className="flex min-h-screen bg-slate-50 font-sans text-slate-900">
      {/* Mobile Sidebar Overlay */}
      {isSidebarOpen && (
        <div 
          className="fixed inset-0 bg-slate-900/50 z-40 lg:hidden"
          onClick={() => setIsSidebarOpen(false)}
        />
      )}

      {/* Sidebar */}
      <aside className={`
        fixed inset-y-0 left-0 w-64 bg-slate-900 text-white p-6 shadow-xl z-50 transform transition-transform duration-300 lg:relative lg:translate-x-0
        ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full'}
      `}>
        <div className="flex items-center justify-between mb-10 px-2">
          <div className="flex items-center gap-3">
            <div className="p-2 bg-blue-500 rounded-lg">
              <Globe className="w-6 h-6 text-white" />
            </div>
            <span className="text-xl font-bold tracking-tight">Global CRM</span>
          </div>
          <button className="lg:hidden" onClick={() => setIsSidebarOpen(false)}>
            <X size={20} />
          </button>
        </div>
        
        <nav className="space-y-2 flex-1">
          <button className="flex items-center gap-3 w-full p-3 rounded-xl bg-blue-600 text-white font-medium transition-all">
            <LayoutDashboard size={20} /> ëŒ€ì‹œë³´ë“œ
          </button>
          <button className="flex items-center gap-3 w-full p-3 rounded-xl hover:bg-slate-800 text-slate-400 hover:text-white transition-all">
            <Users size={20} /> ê±°ë˜ì²˜ ê´€ë¦¬
          </button>
          <button className="flex items-center gap-3 w-full p-3 rounded-xl hover:bg-slate-800 text-slate-400 hover:text-white transition-all">
            <TrendingUp size={20} /> ë§¤ì¶œ ë¶„ì„
          </button>
        </nav>

        <div className="mt-10 p-4 bg-slate-800 rounded-2xl">
          <p className="text-xs text-slate-400 mb-1">ì‹œìŠ¤í…œ ìƒíƒœ</p>
          <div className="flex items-center gap-2">
            <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
            <span className="text-sm font-medium">ì‹¤ì‹œê°„ ë™ê¸°í™” ì¤‘</span>
          </div>
        </div>
      </aside>

      {/* Main Content */}
      <main className="flex-1 w-full overflow-x-hidden p-4 md:p-8">
        <header className="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
          <div className="flex items-center gap-4">
            <button 
              className="lg:hidden p-2 bg-white border border-slate-200 rounded-lg"
              onClick={() => setIsSidebarOpen(true)}
            >
              <Menu size={20} />
            </button>
            <div>
              <h1 className="text-2xl font-bold text-slate-800">2026 í•´ì™¸ê±°ë˜ì„  ê´€ë¦¬</h1>
              <p className="text-slate-500 text-sm">ê¸€ë¡œë²Œ ë¹„ì¦ˆë‹ˆìŠ¤ íŒŒíŠ¸ë„ˆ ë° ë§¤ì¶œ í˜„í™©</p>
            </div>
          </div>
          <div className="flex items-center gap-3">
            <button className="flex items-center gap-2 px-4 py-2 bg-white border border-slate-200 rounded-lg shadow-sm text-sm font-medium hover:bg-slate-50 transition-colors">
              <Download size={16} /> ë¦¬í¬íŠ¸
            </button>
            <div className="w-10 h-10 bg-slate-200 rounded-full overflow-hidden border-2 border-white shadow-sm">
              <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="User" />
            </div>
          </div>
        </header>

        {/* Stats Cards */}
        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 mb-8">
          <StatCard 
            icon={<DollarSign className="text-blue-600" />} 
            label="25ë…„ ì´ ë§¤ì¶œ (USD)" 
            value={`$${totalSales25.toLocaleString()}`} 
            trend="+12.5%" 
            color="bg-blue-50"
          />
          <StatCard 
            icon={<Users className="text-emerald-600" />} 
            label="í™œì„± ê±°ë˜ì²˜" 
            value={filteredData.filter(d => d.status === 'Existing').length} 
            trend="2ê°œ ì¶”ê°€" 
            color="bg-emerald-50"
          />
          <StatCard 
            icon={<Globe className="text-purple-600" />} 
            label="ì§„ì¶œ êµ­ê°€" 
            value={[...new Set(mockData.map(d => d.country))].length} 
            trend="ì „ ì„¸ê³„" 
            color="bg-purple-50"
          />
          <StatCard 
            icon={<ShieldCheck className="text-amber-600" />} 
            label="ì¸ì¦ í˜„í™©" 
            value="85%" 
            trend="ì§„í–‰ ì¤‘" 
            color="bg-amber-50"
          />
        </div>

        {/* Filter & Table Area */}
        <div className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
          <div className="p-4 md:p-6 border-b border-slate-100">
            <div className="flex flex-col xl:flex-row gap-4 items-start xl:items-center justify-between">
              <div className="flex bg-slate-100 p-1 rounded-xl w-full xl:w-auto overflow-x-auto no-scrollbar">
                <TabButton active={activeTab === 'all'} onClick={() => setActiveTab('all')} label="ì „ì²´" />
                <TabButton active={activeTab === 'existing'} onClick={() => setActiveTab('existing')} label="ê¸°ì¡´" />
                <TabButton active={activeTab === 'new'} onClick={() => setActiveTab('new')} label="ì‹ ê·œ" />
              </div>
              
              <div className="flex flex-col sm:flex-row items-center gap-3 w-full xl:w-auto">
                <div className="relative w-full sm:w-64">
                  <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 w-4 h-4" />
                  <input 
                    type="text" 
                    placeholder="êµ­ê°€, ë°”ì´ì–´ëª… ê²€ìƒ‰..."
                    className="w-full pl-10 pr-4 py-2 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                    value={searchTerm}
                    onChange={(e) => setSearchTerm(e.target.value)}
                  />
                </div>
                <select 
                  className="w-full sm:w-auto px-4 py-2 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:outline-none"
                  value={selectedRegion}
                  onChange={(e) => setSelectedRegion(e.target.value)}
                >
                  {regions.map(r => <option key={r} value={r}>{r}</option>)}
                </select>
              </div>
            </div>
          </div>

          <div className="overflow-x-auto">
            <table className="w-full text-left border-collapse min-w-[800px]">
              <thead>
                <tr className="bg-slate-50/50 text-slate-500 text-xs font-semibold uppercase tracking-wider">
                  <th className="px-6 py-4">êµ­ê°€ / ì§€ì—­</th>
                  <th className="px-6 py-4">ë°”ì´ì–´ ì •ë³´</th>
                  <th className="px-6 py-4 text-right">25ë…„ ë§¤ì¶œ</th>
                  <th className="px-6 py-4">ì¸ì¦ / ê·œì œ</th>
                  <th className="px-6 py-4">í˜„ì§€ ì‹œê°„</th>
                  <th className="px-6 py-4 text-center">ìƒíƒœ</th>
                </tr>
              </thead>
              <tbody className="divide-y divide-slate-100">
                {filteredData.map((item, idx) => (
                  <tr key={idx} className="hover:bg-slate-50/80 transition-colors group">
                    <td className="px-6 py-4">
                      <div className="flex items-center gap-3">
                        <div className="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-lg shadow-sm flex-shrink-0">
                          {item.country.includes('ì¤‘êµ­') ? 'ğŸ‡¨ğŸ‡³' : item.country.includes('ë¯¸êµ­') ? 'ğŸ‡ºğŸ‡¸' : item.country.includes('í˜¸ì£¼') ? 'ğŸ‡¦ğŸ‡º' : item.country.includes('í”„ë‘ìŠ¤') ? 'ğŸ‡«ğŸ‡·' : 'ğŸŒ'}
                        </div>
                        <div className="min-w-0">
                          <div className="font-semibold text-slate-800 flex items-center gap-1 truncate">
                            {item.country} <ExternalLink size={12} className="text-slate-300 group-hover:text-blue-500 cursor-pointer flex-shrink-0" />
                          </div>
                          <div className="text-xs text-slate-500 truncate">{item.region} â€¢ {item.city}</div>
                        </div>
                      </div>
                    </td>
                    <td className="px-6 py-4">
                      <div className="text-sm font-medium text-slate-700">{item.buyer}</div>
                      <div className="text-xs text-slate-400">{item.contact} ({item.type})</div>
                    </td>
                    <td className="px-6 py-4 text-right">
                      <div className="text-sm font-bold text-slate-900">${item.sales25.toLocaleString()}</div>
                    </td>
                    <td className="px-6 py-4">
                      <span className="inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-medium bg-blue-50 text-blue-700 border border-blue-100">
                        <FileCheck size={12} /> {item.cert}
                      </span>
                    </td>
                    <td className="px-6 py-4">
                      <div className="flex items-center gap-1.5 text-xs text-slate-600 font-medium bg-slate-100 px-2 py-1 rounded-md w-fit">
                        <Clock size={12} /> {item.localTime}
                      </div>
                    </td>
                    <td className="px-6 py-4 text-center">
                      <span className={`px-2.5 py-1 rounded-full text-xs font-bold ${
                        item.status === 'Existing' ? 'bg-emerald-100 text-emerald-700' : 'bg-amber-100 text-amber-700'
                      }`}>
                        {item.status === 'Existing' ? 'í™œì„±' : 'ì‹ ê·œ'}
                      </span>
                    </td>
                  </tr>
                ))}
                {filteredData.length === 0 && (
                  <tr>
                    <td colSpan="6" className="px-6 py-20 text-center text-slate-400">
                      <div className="flex flex-col items-center gap-2">
                        <AlertCircle size={40} className="text-slate-200" />
                        <p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                      </div>
                    </td>
                  </tr>
                )}
              </tbody>
            </table>
          </div>
        </div>
      </main>
    </div>
  );
};

const StatCard = ({ icon, label, value, trend, color }) => (
  <div className="bg-white p-5 md:p-6 rounded-2xl shadow-sm border border-slate-200 hover:shadow-md transition-shadow">
    <div className="flex items-start justify-between mb-4">
      <div className={`p-3 rounded-xl ${color}`}>
        {icon}
      </div>
      <span className={`text-[10px] md:text-xs font-bold px-2 py-1 rounded-lg ${
        trend.includes('+') ? 'bg-emerald-100 text-emerald-700' : 'bg-slate-100 text-slate-600'
      }`}>
        {trend}
      </span>
    </div>
    <h3 className="text-slate-500 text-xs md:text-sm font-medium mb-1">{label}</h3>
    <p className="text-xl md:text-2xl font-bold text-slate-900">{value}</p>
  </div>
);

const TabButton = ({ active, onClick, label }) => (
  <button 
    onClick={onClick}
    className={`px-4 md:px-6 py-2 rounded-lg text-xs md:text-sm font-medium transition-all whitespace-nowrap ${
      active 
        ? 'bg-white text-blue-600 shadow-sm' 
        : 'text-slate-500 hover:text-slate-700'
    }`}
  >
    {label}
  </button>
);

export default App;